{"ast":null,"code":"import{useState,useRef,useEffect}from\"react\";import\"./index.css\";import Navbar from\"../Navbar\";import StarRating from\"./rating\";import CommentCard from\"./commentCard\";import Editor from\"./editor\";import{BiUserCircle}from\"react-icons/bi\";import sanityClient from\"../../client\";import axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var imageUrlRegex=/\\b(https?:\\/\\/[^\\s]+)/g;const config={url:\"\".concat(process.env.REACT_APP_BASE_URL),method:\"post\",headers:{\"Content-type\":\"application/json\",Authorization:\"Bearer \".concat(process.env.REACT_APP_BEARER_TOKEN)}};export default function Discussion(){const[name,setName]=useState(\"\");const[rating,setRating]=useState(0);const[imageUrl,setImageUrl]=useState(\"\");const commentRef=useRef();const[commentList,setCommentList]=useState(null);const[urlList,setUrlList]=useState([]);const handleSubmit=e=>{e.preventDefault();if(name===\"\"||commentRef.length===\"\"){window.alert(\"Enter the credentials\");}else{axios({...config,data:{mutations:[{create:{name,content:commentRef.current.innerText,rating,_type:\"Comment\"}}]}}).then(result=>console.log(result)).catch(error=>console.error(error));const newComment=commentList.unshift({name,content:commentRef.current.innerText,rating,_type:\"Comment\"});setName(\"\");setImageUrl(\"\");commentRef.current.innerText=\"\";setCommentList(...newComment,...commentList);}};const handleNameChange=e=>{setName(e.target.value);};const handleCommentChange=e=>{const value=e.currentTarget.innerText;const newLength=value===null||value===void 0?void 0:value.length;if(newLength===0){setUrlList([]);setImageUrl();return;}if(value!==null&&value!==void 0&&value.match(imageUrlRegex)){setUrlList(value===null||value===void 0?void 0:value.match(imageUrlRegex));}else{setUrlList([]);}};useEffect(()=>{if((urlList===null||urlList===void 0?void 0:urlList.length)!==0){setImageUrl(urlList[0]);}else{setImageUrl(\"\");}},[urlList]);const deleteComment=id=>{axios({...config,data:{mutations:[{delete:{id:id}}]}}).then(result=>console.log(result)).catch(error=>console.error(error));let removeData=[...commentList];removeData.splice(id,1);setCommentList(removeData);};useEffect(()=>{sanityClient.fetch(\"*[_type == \\\"Comment\\\"]{\\n      _id,\\n      name,\\n      content,\\n      rating,\\n      hexCode,\\n    } | order(_createdAt desc)\").then(commentList=>{setCommentList(commentList);}).catch(console.error);},[]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Navbar,{}),/*#__PURE__*/_jsx(\"div\",{className:\"discussion\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"right\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"discuss\",children:\"JOB DISQUS\"}),/*#__PURE__*/_jsxs(\"form\",{className:\"comment-form\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"input-group\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"comment-name\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"line\",children:[\" \",commentList===null||commentList===void 0?void 0:commentList.length,\" Comments\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"icon-name\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"user-icon\",children:/*#__PURE__*/_jsx(BiUserCircle,{})}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Your name\",className:\"form-control\",value:name,onChange:handleNameChange})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"star-rating\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"rating-text\",children:\"You rated this \"}),/*#__PURE__*/_jsx(StarRating,{onChange:setRating})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-group\",children:[/*#__PURE__*/_jsx(\"div\",{type:\"text\",className:\"form-control comment\",contentEditable:\"true\",\"data-testid\":\"comment-section-test\",\"data-placeholder\":\"Join the discussion....\",onInput:handleCommentChange,ref:commentRef}),/*#__PURE__*/_jsxs(\"div\",{className:\"icon-button\",children:[/*#__PURE__*/_jsx(Editor,{onUrlChange:setUrlList,commentRef:commentRef}),/*#__PURE__*/_jsx(\"button\",{className:\"submit\",\"data-testid\":\"reset-comment\",onClick:handleSubmit,children:\"Comment\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"only-image\",children:imageUrl&&/*#__PURE__*/_jsx(\"img\",{src:imageUrl,\"data-testid\":\"image-preview\",className:\"\".concat(imageUrl?\"image-text-editor\":\"\")})})]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"comment-section\",children:/*#__PURE__*/_jsx(\"div\",{className:\"comment-box\",children:commentList&&(commentList===null||commentList===void 0?void 0:commentList.map(comments=>{return/*#__PURE__*/_jsx(CommentCard,{value:comments,deleteComment:()=>deleteComment(comments._id)},comments._id);}))})})]});}","map":{"version":3,"names":["useState","useRef","useEffect","Navbar","StarRating","CommentCard","Editor","BiUserCircle","sanityClient","axios","imageUrlRegex","config","url","process","env","REACT_APP_BASE_URL","method","headers","Authorization","REACT_APP_BEARER_TOKEN","Discussion","name","setName","rating","setRating","imageUrl","setImageUrl","commentRef","commentList","setCommentList","urlList","setUrlList","handleSubmit","e","preventDefault","length","window","alert","data","mutations","create","content","current","innerText","_type","then","result","console","log","catch","error","newComment","unshift","handleNameChange","target","value","handleCommentChange","currentTarget","newLength","match","deleteComment","id","delete","removeData","splice","fetch","map","comments","_id"],"sources":["/home/vishal/projects/fullstack/frontend/src/components/Discussion/index.jsx"],"sourcesContent":["import { useState, useRef, useEffect } from \"react\";\nimport \"./index.css\";\nimport Navbar from \"../Navbar\";\nimport StarRating from \"./rating\";\nimport CommentCard from \"./commentCard\";\nimport Editor from \"./editor\";\nimport { BiUserCircle } from \"react-icons/bi\";\nimport sanityClient from \"../../client\";\nimport axios from \"axios\";\n\nvar imageUrlRegex = /\\b(https?:\\/\\/[^\\s]+)/g;\n\nconst config = {\n  url: `${process.env.REACT_APP_BASE_URL}`,\n  method: \"post\",\n  headers: {\n    \"Content-type\": \"application/json\",\n    Authorization: `Bearer ${process.env.REACT_APP_BEARER_TOKEN}`,\n  },\n};\n\nexport default function Discussion() {\n  const [name, setName] = useState(\"\");\n  const [rating, setRating] = useState(0);\n  const [imageUrl, setImageUrl] = useState(\"\");\n  const commentRef = useRef();\n  const [commentList, setCommentList] = useState(null);\n  const [urlList, setUrlList] = useState([]);\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    if (name === \"\" || commentRef.length === \"\") {\n      window.alert(\"Enter the credentials\");\n    } else {\n      axios({\n        ...config,\n        data: {\n          mutations: [\n            {\n              create: {\n                name,\n                content: commentRef.current.innerText,\n                rating,\n                _type: \"Comment\",\n              },\n            },\n          ],\n        },\n      })\n        .then((result) => console.log(result))\n        .catch((error) => console.error(error));\n\n      const newComment = commentList.unshift({\n        name,\n        content: commentRef.current.innerText,\n        rating,\n        _type: \"Comment\",\n      });\n      setName(\"\");\n      setImageUrl(\"\");\n      commentRef.current.innerText = \"\";\n      setCommentList(...newComment, ...commentList);\n    }\n  };\n\n  const handleNameChange = (e) => {\n    setName(e.target.value);\n  };\n  const handleCommentChange = (e) => {\n    const value = e.currentTarget.innerText;\n    const newLength = value?.length;\n    if (newLength === 0) {\n      setUrlList([]);\n      setImageUrl();\n      return;\n    }\n    if (value?.match(imageUrlRegex)) {\n      setUrlList(value?.match(imageUrlRegex));\n    } else {\n      setUrlList([]);\n    }\n  };\n\n  useEffect(() => {\n    if (urlList?.length !== 0) {\n      setImageUrl(urlList[0]);\n    } else {\n      setImageUrl(\"\");\n    }\n  }, [urlList]);\n\n  const deleteComment = (id) => {\n    axios({\n      ...config,\n      data: {\n        mutations: [\n          {\n            delete: {\n              id: id,\n            },\n          },\n        ],\n      },\n    })\n      .then((result) => console.log(result))\n      .catch((error) => console.error(error));\n    let removeData = [...commentList];\n    removeData.splice(id, 1);\n    setCommentList(removeData);\n  };\n  useEffect(() => {\n    sanityClient\n      .fetch(\n        `*[_type == \"Comment\"]{\n      _id,\n      name,\n      content,\n      rating,\n      hexCode,\n    } | order(_createdAt desc)`\n      )\n      .then((commentList) => {\n        setCommentList(commentList);\n      })\n      .catch(console.error);\n  }, []);\n  return (\n    <>\n      <Navbar />\n      <div className=\"discussion\">\n        <div className=\"right\">\n          <div className=\"discuss\">JOB DISQUS</div>\n\n          <form className=\"comment-form\">\n            <div className=\"input-group\">\n              <div className=\"comment-name\">\n                <div className=\"line\"> {commentList?.length} Comments</div>\n                <div className=\"icon-name\">\n                  <div className=\"user-icon\">\n                    <BiUserCircle />\n                  </div>\n                  <input\n                    type=\"text\"\n                    placeholder=\"Your name\"\n                    className=\"form-control\"\n                    value={name}\n                    onChange={handleNameChange}\n                  />\n                </div>\n              </div>\n            </div>\n            <div className=\"star-rating\">\n              <div className=\"rating-text\">You rated this </div>\n              <StarRating onChange={setRating} />\n            </div>\n            <div className=\"input-group\">\n              <div\n                type=\"text\"\n                className=\"form-control comment\"\n                contentEditable=\"true\"\n                data-testid=\"comment-section-test\"\n                data-placeholder=\"Join the discussion....\"\n                onInput={handleCommentChange}\n                ref={commentRef}\n              />\n              <div className=\"icon-button\">\n                <Editor onUrlChange={setUrlList} commentRef={commentRef} />\n\n                <button\n                  className=\"submit\"\n                  data-testid=\"reset-comment\"\n                  onClick={handleSubmit}\n                >\n                  Comment\n                </button>\n              </div>\n              <div className=\"only-image\">\n                {imageUrl && (\n                  <img\n                    src={imageUrl}\n                    data-testid=\"image-preview\"\n                    className={`${imageUrl ? \"image-text-editor\" : \"\"}`}\n                  />\n                )}\n              </div>\n            </div>\n          </form>\n        </div>\n      </div>\n      <div className=\"comment-section\">\n        <div className=\"comment-box\">\n          {commentList &&\n            commentList?.map((comments) => {\n              return (\n                <CommentCard\n                  key={comments._id}\n                  value={comments}\n                  deleteComment={() => deleteComment(comments._id)}\n                />\n              );\n            })}\n        </div>\n      </div>\n    </>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}